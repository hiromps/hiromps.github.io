<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VALORANT Tracker Overlay</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&family=Rajdhani:wght@400;500;600;700&family=Orbitron:wght@400;500;700;800;900&display=swap" rel="stylesheet">
    <!-- Google AdSense script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6090439809602995"
     crossorigin="anonymous"></script>
 <style>
        /* åŸºæœ¬çš„ãªãƒ˜ãƒƒãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ« */
        .app-header {
            padding: 1rem;
            background-color: rgba(15, 25, 35, 0.95);
            border-bottom: 2px solid #ff4655;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
            width: 100%;
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .nav-buttons {
            display: flex;
            gap: 1rem;
        }
        .app-header button,
        .app-header a.header-button {
            background-color: #ff4655;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            margin: 0 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            text-decoration: none; /* ä¸‹ç·šã‚’æ¶ˆã™ */
            display: inline-block; /* ãƒœã‚¿ãƒ³ã‚‰ã—ãè¦‹ã›ã‚‹ãŸã‚ */
            box-shadow: 0 2px 8px rgba(255, 70, 85, 0.3);
        }
        .app-header button:hover,
        .app-header a.header-button:hover {
            background-color: #e0303f;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 70, 85, 0.4);
        }
        .app-header button.active,
        .app-header a.header-button.active {
            background-color: #22c55e; /* ç·‘ãªã©ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’ç¤ºã™ */
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
            text-decoration: none; /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã‚‚ä¸‹ç·šã‚’æ¶ˆã™ */
        }
        @media screen and (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                padding: 0 10px;
                align-items: center;
            }
            .nav-buttons {
                flex-direction: row;
                width: 100%;
                gap: 0.3rem;
                justify-content: center;
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            .nav-buttons .header-button {
                width: auto;
                text-align: center;
                margin: 0;
                padding: 0.4rem 0.7rem;
                font-size: 0.85rem;
                min-width: 80px;
                white-space: nowrap;
            }
            .author-section {
                margin-top: 10px;
            }
        }
        .mode-container {
            /* display: none; */ /* åˆæœŸçŠ¶æ…‹ã¯JSã§åˆ¶å¾¡ */
        }
        .hidden {
            display: none !important;
        }
        #showOverlayModeLink {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #showTrackerModeLink {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .theme-selector {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .theme-button {
            padding: 0.5rem 1rem;
            border: 2px solid #374151;
            background: transparent;
            color: #9ca3af;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }
        .theme-button:hover {
            border-color: #6b7280;
            color: #d1d5db;
        }
        .theme-button.active {
            border-color: #ff4655;
            background: #ff4655;
            color: white;
        }
        /* å…¨ãƒ†ãƒ¼ãƒå…±é€š - æ–‡å­—é€”åˆ‡ã‚Œé˜²æ­¢ */
        .overlay .rank-name {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
            min-width: 0;
            word-break: keep-all;
        }

        .overlay .rr {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
        }

        .overlay .last-match-text {
            white-space: nowrap;
            overflow: visible;
            text-overflow: unset;
        }

        .overlay .rank-details {
            min-width: 0;
            flex: 1;
            overflow: visible;
        }

        .overlay .rank-name-line {
            min-width: 0;
            overflow: visible;
            flex-wrap: wrap;
            gap: 5px;
        }
        /* ãƒ†ãƒ¼ãƒåˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
        /* ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒï¼ˆç¾åœ¨ã®ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰ */
        .theme-classic .overlay {
            background: var(--overlay-bg-color);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: none;
            width: auto;
            min-width: 300px;
            max-width: 400px;
        }

        .theme-classic .rank-section {
            background: var(--rank-bg-color);
            padding: 6px 10px;
        }

        .theme-classic .rank-icon {
            width: 60px;
            height: 60px;
            border: none !important;
            box-shadow: none !important;
            background: none !important;
            outline: none !important;
        }

        .theme-classic .rank-name {
            font-size: clamp(1rem, 3.5vw, 1.3rem);
        }

        .theme-classic .rr {
            font-size: clamp(0.95rem, 3vw, 1.2rem);
            margin-right: 8px;
        }

        .theme-classic .last-match-section {
            background-color: var(--last-match-bg-color);
            padding: 6px 10px;
        }

        .theme-classic .last-match-text {
            color: var(--text-color);
            font-weight: 600;
            font-size: clamp(0.9rem, 2.5vw, 1rem) !important;
            line-height: 1.3;
        }

        /* ãƒ¢ãƒ€ãƒ³ãƒ†ãƒ¼ãƒ - ã‚«ãƒ¼ãƒ‰åˆ†å‰²ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        .theme-modern .overlay {
            background: transparent;
            backdrop-filter: none;
            border: none;
            border-radius: 0;
            box-shadow: none;
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
            width: auto;
            min-width: 320px;
            max-width: 380px;
        }

        .theme-modern .rank-section {
            background: var(--rank-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 14px 18px;
            box-shadow: none;
            position: relative;
            overflow: hidden;
            min-height: auto;
        }

        .theme-modern .rank-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            border-radius: 16px 16px 0 0;
        }

        .theme-modern .rank-icon {
            width: 52px;
            height: 52px;
            border-radius: 12px;
            flex-shrink: 0;
            border: none !important;
            box-shadow: none !important;
            background: none !important;
            outline: none !important;
        }

        .theme-modern .rank-name {
            font-size: clamp(1rem, 3vw, 1.15rem);
            font-weight: 700;
            background: linear-gradient(135deg, #f1f5f9, #cbd5e1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }

        .theme-modern .rr {
            font-size: clamp(1.1rem, 3.5vw, 1.3rem);
            font-weight: 800;
            color: var(--rr-color);
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
            line-height: 1.1;
        }

        .theme-modern .last-match-section {
            background: var(--last-match-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 12px 18px;
            box-shadow: none;
            position: relative;
            min-height: auto;
            width: 100%;
            overflow: hidden;
        }

        .theme-modern .last-match-text {
            color: var(--text-color);
            font-weight: 600;
            font-size: clamp(0.9rem, 2.5vw, 1rem) !important;
            line-height: 1.3;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        /* Cyberãƒ†ãƒ¼ãƒ - VALORANTé¢¨ã‚µã‚¤ãƒãƒ¼ãƒ†ãƒƒã‚¯ */
        .theme-shadcn .overlay {
            background: transparent;
            backdrop-filter: none;
            border: none;
            border-radius: 0;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: auto;
            min-width: 340px;
            max-width: 420px;
            padding: 0;
            position: relative;
        }

        .theme-shadcn .rank-section {
            background: var(--rank-bg-color);
            border: 1px solid var(--border-color);
            border-left: 4px solid var(--border-color);
            border-radius: 12px;
            padding: 14px 18px;
            position: relative;
            overflow: hidden;
            box-shadow: none;
            min-height: auto;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .theme-shadcn .rank-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                var(--border-color) 0%, 
                #00f5ff 50%, 
                var(--border-color) 100%
            );
        }

        .theme-shadcn .rank-section::after {
            content: '';
            position: absolute;
            top: 6px;
            right: 6px;
            width: 6px;
            height: 6px;
            background: #00f5ff;
            border-radius: 50%;
            box-shadow: 0 0 6px #00f5ff;
            animation: pulse-valorant 2s ease-in-out infinite;
        }

        .theme-shadcn .rank-icon {
            width: 52px;
            height: 52px;
            border-radius: 8px;
            flex-shrink: 0;
            border: none !important;
            box-shadow: none !important;
            background: none !important;
            outline: none !important;
        }

        .theme-shadcn .rank-details {
            display: flex;
            flex-direction: column;
            gap: 3px;
            align-items: flex-start;
            flex: 1;
        }

        .theme-shadcn .rank-name-line {
            display: flex;
            flex-direction: column;
            gap: 1px;
            align-items: flex-start;
            width: 100%;
        }

        .theme-shadcn .rank-name {
            color: var(--text-color);
            font-weight: 700;
            font-size: clamp(1.1rem, 3.5vw, 1.3rem);
            line-height: 1.1;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-family: 'Rajdhani', 'Arial', sans-serif;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
        }

        .theme-shadcn .rr {
            color: var(--rr-color);
            font-weight: 800;
            font-size: clamp(1.3rem, 4.5vw, 1.6rem);
            line-height: 1;
            font-family: 'Orbitron', 'Arial', sans-serif;
            letter-spacing: 2px;
            text-shadow: 
                0 0 10px rgba(255, 70, 85, 0.6),
                0 0 20px rgba(255, 70, 85, 0.3);
        }

        .theme-shadcn .last-match-section {
            background: var(--last-match-bg-color);
            border: 1px solid var(--border-color);
            border-right: 4px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 18px;
            position: relative;
            overflow: hidden;
            box-shadow: none;
            min-height: auto;
            width: 100%;
        }

        .theme-shadcn .last-match-section::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                #00f5ff 0%, 
                var(--border-color) 50%, 
                #00f5ff 100%
            );
        }

        .theme-shadcn .last-match-section::after {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 6px;
            width: 5px;
            height: 5px;
            background: var(--border-color);
            border-radius: 50%;
            box-shadow: 0 0 5px var(--border-color);
            animation: pulse-valorant 2.5s ease-in-out infinite;
        }

        .theme-shadcn .last-match-text {
            color: var(--text-color);
            font-weight: 600;
            font-size: clamp(1rem, 3.2vw, 1.2rem) !important;
            line-height: 1.2;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Rajdhani', 'Arial', sans-serif;
            text-shadow: 0 0 6px rgba(255, 255, 255, 0.2);
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .theme-shadcn .mmr-gauge-fill {
            background: linear-gradient(90deg, 
                var(--rr-color) 0%, 
                #00f5ff 50%, 
                var(--rr-color) 100%
            );
            border-radius: 0;
            box-shadow: 
                0 0 8px rgba(255, 70, 85, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            height: 3px;
        }

        /* ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼é¢¨ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³åŠ¹æœ */
        @keyframes scan-line {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(400px); }
        }

        .theme-shadcn .rank-section .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                #00f5ff 50%, 
                transparent 100%
            );
            animation: scan-line 3s linear infinite;
            pointer-events: none;
        }

        /* Neonãƒ†ãƒ¼ãƒ - ã‚µã‚¤ãƒãƒ¼ãƒ‘ãƒ³ã‚¯é¢¨ */
        .theme-neon .overlay {
            background: transparent;
            backdrop-filter: none;
            border: none;
            border-radius: 0;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: auto;
            min-width: 340px;
            max-width: 420px;
        }

        .theme-neon .rank-section {
            background: var(--rank-bg-color);
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 20px;
            padding: 18px 20px;
            position: relative;
            overflow: hidden;
            box-shadow: none;
            min-height: auto;
        }

        .theme-neon .rank-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--border-color), #ff00ff, #ffff00, var(--border-color));
            border-radius: 20px;
            z-index: -1;
            animation: neonBorder 3s linear infinite;
        }

        .theme-neon .rank-section::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--rank-bg-color);
            border-radius: 18px;
            z-index: -1;
        }

        .theme-neon .rank-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            flex-shrink: 0;
            border: none !important;
            box-shadow: none !important;
            background: none !important;
            outline: none !important;
        }

        .theme-neon .rank-name {
            font-size: clamp(1.1rem, 3.5vw, 1.25rem);
            font-weight: 800;
            color: var(--text-color);
            text-shadow: 
                0 0 10px rgba(0, 255, 255, 0.8),
                0 0 20px rgba(0, 255, 255, 0.5),
                0 0 30px rgba(0, 255, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.1;
        }

        .theme-neon .rr {
            font-size: clamp(1.25rem, 4.5vw, 1.5rem);
            font-weight: 900;
            color: var(--rr-color);
            text-shadow: 
                0 0 10px rgba(255, 0, 255, 0.8),
                0 0 20px rgba(255, 0, 255, 0.5);
            line-height: 1;
        }

        .theme-neon .last-match-section {
            background: var(--last-match-bg-color);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 12px 18px;
            position: relative;
            box-shadow: none;
            min-height: auto;
            width: 100%;
            overflow: hidden;
        }

        .theme-neon .last-match-text {
            color: var(--text-color);
            font-weight: 700;
            font-size: clamp(0.95rem, 3vw, 1.05rem) !important;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.2;
            width: 100%;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .theme-neon .mmr-gauge-fill {
            background: linear-gradient(90deg, var(--rr-color), #ff00ff);
            border-radius: 0;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        @keyframes neonBorder {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse-valorant {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <header class="app-header">
        <div class="header-content">
            <div class="nav-buttons">
                <a href="/" id="showOverlayModeLink" class="header-button active">OBSã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤</a>
                <a href="./valorant-stats-tracker/" id="showTrackerModeLink" class="header-button">æˆ¦ç¸¾ãƒˆãƒ©ãƒƒã‚«ãƒ¼</a>
            </div>
            <div class="author-section">
                <p class="author-text">Project by ã«ã©å¯</p>
                <img src="assets/images/nidone.png" alt="è£½ä½œè€…ã‚¢ãƒã‚¿ãƒ¼" class="author-avatar">
            </div>
        </div>
    </header>
    <div class="background"></div>

    <!-- Google AdSenseåºƒå‘Šãƒ¦ãƒ‹ãƒƒãƒˆ -->
    <div class="ad-container">
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-6090439809602995"
             data-ad-slot="1000000000000000"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="main-content-container">
        <div id="inputSection" class="input-section">
            <h2>VALORANT ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±</h2>
            <div class="input-form">
                <input type="text" id="playerName" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å" required>
                <input type="text" id="playerTag" placeholder="ã‚¿ã‚°" required>
                <button onclick="generateURL()">URLã‚’ç”Ÿæˆ</button>
            </div>
            <div class="url-output">
                <input type="text" id="generatedURL" readonly>
                <button onclick="copyURL()">ã‚³ãƒ”ãƒ¼</button>
            </div>
        </div>

        <div class="right-column">
            <div class="overlay">
                <div class="rank-section">
                    <img src="assets/images/ranks/ãƒ©ãƒ³ã‚¯ãªã—.png" alt="Rank Icon" class="rank-icon" id="rankIcon">
                    <div class="rank-details">
                        <div class="rank-name-line">
                            <span class="rank-name" id="rankText">ãƒ©ãƒ³ã‚¯ãªã—</span> <span class="rr" id="rrText">0RR</span>
                        </div>
                        <!-- <span class="win-loss" id="winLossText">0 Win / 0 Loss</span> -->
                    </div>
                </div>
                <div class="last-match-section" id="lastMatchSection">
                    <div class="mmr-gauge-fill"></div>
                    <span class="last-match-text" id="lastMatchText">å‰å›ã®ãƒãƒƒãƒ +0pts</span>
                </div>
                <!-- OBSç”¨ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
                <div id="obsDebugInfo" style="display: none; font-size: 12px; color: #888; margin-top: 10px;">
                    <div>è‡ªå‹•æ›´æ–°: <span id="autoUpdateStatus">ç„¡åŠ¹</span></div>
                    <div>æœ€çµ‚æ›´æ–°: <span id="lastUpdateTime">-</span></div>
                    <button onclick="manualUpdate()" style="margin-top: 5px; padding: 2px 8px; font-size: 10px;">æ‰‹å‹•æ›´æ–°</button>
                </div>
            </div>
            
            <!-- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒœã‚¿ãƒ³ -->
            <div class="customize-button-container">
                <button id="customizeButton">ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</button>
            </div>
        </div>
    </div>

    <!-- OBSãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="tutorial-section">
        <button class="tutorial-toggle" onclick="toggleTutorial()">
            ğŸ“º OBSè¨­å®šã‚¬ã‚¤ãƒ‰ <span id="tutorialArrow" class="rotated">â–¼</span>
        </button>
        <div class="tutorial-content expanded" id="tutorialContent">
            <div class="tutorial-step">
                <h4>ğŸ¯ ã‚¹ãƒ†ãƒƒãƒ— 1: URLã‚’ç”Ÿæˆ</h4>
                <p>ä¸Šè¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã¨ã‚¿ã‚°ã‚’å…¥åŠ›ã—ã€ã€ŒURLã‚’ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            <div class="tutorial-step">
                <h4>ğŸ–¥ï¸ ã‚¹ãƒ†ãƒƒãƒ— 2: OBSã§ãƒ–ãƒ©ã‚¦ã‚¶ã‚½ãƒ¼ã‚¹ã‚’è¿½åŠ </h4>
                <ol>
                    <li>OBS Studioã‚’é–‹ã</li>
                    <li>ã€Œã‚½ãƒ¼ã‚¹ã€ã®ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                    <li>ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã€ã‚’é¸æŠ</li>
                    <li>ã€Œæ–°è¦ä½œæˆã€ã‚’é¸æŠã—ã¦OKã‚’æŠ¼ã™</li>
                </ol>
            </div>
            <div class="tutorial-step">
                <h4>âš™ï¸ ã‚¹ãƒ†ãƒƒãƒ— 3: ãƒ–ãƒ©ã‚¦ã‚¶ã‚½ãƒ¼ã‚¹ã®è¨­å®šï¼ˆé«˜ç”»è³ªæ¨å¥¨ï¼‰</h4>
                <ul>
                    <li><strong>URL:</strong> ç”Ÿæˆã•ã‚ŒãŸURLã‚’ã‚³ãƒ”ãƒ¼&ãƒšãƒ¼ã‚¹ãƒˆ</li>
                    <li><strong>å¹…:</strong> 900ï¼ˆé«˜ç”»è³ªï¼‰ã¾ãŸã¯ 450ï¼ˆæ¨™æº–ï¼‰</li>
                    <li><strong>é«˜ã•:</strong> 400ï¼ˆé«˜ç”»è³ªï¼‰ã¾ãŸã¯ 200ï¼ˆæ¨™æº–ï¼‰</li>
                    <li><strong>ã‚«ã‚¹ã‚¿ãƒ CSS:</strong> ãã®ã¾ã¾</li>
                </ul>
                <p><strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> é«˜ç”»è³ªè¨­å®šå¾Œã€OBSãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§å³ã‚¯ãƒªãƒƒã‚¯â†’ã€Œå¤‰æ›ã€â†’ã€Œç”»é¢ã«åˆã‚ã›ã‚‹ã€ã§é©åˆ‡ãªã‚µã‚¤ã‚ºã«èª¿æ•´ã§ãã¾ã™</p>
            </div>
            <div class="tutorial-step">
                <h4>âœ¨ ã‚¹ãƒ†ãƒƒãƒ— 4: ä½ç½®ã¨ã‚µã‚¤ã‚ºã®èª¿æ•´</h4>
                <p>OBSã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’å¥½ããªä½ç½®ã«ãƒ‰ãƒ©ãƒƒã‚°ã—ã¦é…ç½®ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            <div class="tutorial-note">
                <h4>ğŸ“ æ³¨æ„äº‹é …</h4>
                <ul>
                    <li>ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯30ç§’é–“éš”ã§è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™</li>
                    <li>ãƒ©ãƒ³ã‚¯æƒ…å ±ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯URLã‚’ç”Ÿæˆã—ç›´ã—ã¦ãã ã•ã„</li>
                    <li>APIã®åˆ¶é™ã«ã‚ˆã‚Šã€ä¸€æ™‚çš„ã«ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„å ´åˆãŒã‚ã‚Šã¾ã™</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="colorPickerModal" class="color-picker-modal">
        <div class="color-picker-content">
            <h3>ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</h3>
            <div class="color-picker-section">
                <label>ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ãƒ¼ãƒ:</label>
                <div class="theme-selector">
                    <button type="button" id="themeClassic" class="theme-button active" data-theme="classic">ã‚¯ãƒ©ã‚·ãƒƒã‚¯</button>
                    <button type="button" id="themeModern" class="theme-button" data-theme="modern">ãƒ¢ãƒ€ãƒ³</button>
                                            <button type="button" id="themeShadcn" class="theme-button" data-theme="shadcn">Cyber</button>
                    <button type="button" id="themeNeon" class="theme-button" data-theme="neon">Neon</button>
                </div>
            </div>
            <div class="color-picker-section">
                <label for="rankBgColorPicker">ãƒ©ãƒ³ã‚¯èƒŒæ™¯è‰²:</label>
                <input type="color" id="rankBgColorPicker" value="#3a444e">
                <input type="range" id="rankBgOpacitySlider" min="0" max="100" value="100">
                <span id="rankBgOpacityValue">100%</span>
            </div>
            <div class="color-picker-section">
                <label for="lastMatchBgColorPicker">å‰å›ã®ãƒãƒƒãƒèƒŒæ™¯è‰²:</label>
                <input type="color" id="lastMatchBgColorPicker" value="#F44336">
                <input type="range" id="lastMatchBgOpacitySlider" min="0" max="100" value="100">
                <span id="lastMatchBgOpacityValue">100%</span>
            </div>
            <div class="color-picker-section">
                <label for="textColorPicker">æ–‡å­—è‰²:</label>
                <input type="color" id="textColorPicker" value="#ffffff">
            </div>
            <div class="color-picker-section">
                <label for="rrColorPicker">RRãƒ†ã‚­ã‚¹ãƒˆè‰²:</label>
                <input type="color" id="rrColorPicker" value="#ff4655">
            </div>
            <div class="color-picker-section">
                <label for="borderColorPicker">å¢ƒç•Œç·šè‰²:</label>
                <input type="color" id="borderColorPicker" value="#ff4655">
                <input type="range" id="borderOpacitySlider" min="0" max="100" value="100">
                <span id="borderOpacityValue">100%</span>
            </div>
            <div class="color-picker-buttons">
                <button onclick="applyCustomColors()">é©ç”¨</button>
                <button onclick="closeColorPicker()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                <button onclick="resetCustomColors()">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="js/api.js"></script>
    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã¨æ›´æ–°é–“éš”ã‚’ç®¡ç†
        let currentPlayerName = null;
        let currentPlayerTag = null;
        let updateInterval = null;
        let isAutoUpdateEnabled = false;

        // ãƒ†ãƒ¼ãƒé¸æŠæ©Ÿèƒ½
        let currentTheme = 'classic';

        function applyTheme(theme) {
            const body = document.body;
            // æ—¢å­˜ã®ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
            body.classList.remove('theme-classic', 'theme-modern', 'theme-shadcn', 'theme-neon');
            // æ–°ã—ã„ãƒ†ãƒ¼ãƒã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
            body.classList.add(`theme-${theme}`);
            currentTheme = theme;
            
            // ãƒ†ãƒ¼ãƒã‚’localStorageã«ä¿å­˜
            localStorage.setItem('selectedTheme', theme);
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.theme-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-theme="${theme}"]`).classList.add('active');
            
            // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®å¹…ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå…¨ãƒ†ãƒ¼ãƒã§CSSã«ã‚ˆã‚‹æœ€å°å¹…èª¿æ•´ãŒé©ç”¨ã•ã‚Œã‚‹ï¼‰
            const overlay = document.querySelector('.overlay');
            if (overlay) {
                // ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚¯ãƒªã‚¢ã—ã¦CSSã«å§”è­²
                overlay.style.width = '';
                overlay.style.minWidth = '';
                overlay.style.maxWidth = '';
            }
            
            // Cyberãƒ†ãƒ¼ãƒã®å ´åˆã€ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³åŠ¹æœã‚’è¿½åŠ 
            if (theme === 'shadcn') {
                setTimeout(addScanLineEffect, 100);
            }
            
            // ãƒ†ãƒ¼ãƒå¤‰æ›´å¾Œã«å‰å›ã®ãƒãƒƒãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¹…ã‚’èª¿æ•´ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
            setTimeout(() => {
                if (theme === 'classic') {
                    resetLastMatchWidthForClassic();
                } else {
                    adjustLastMatchWidth();
                }
            }, 200);
        }

        // VALORANTé¢¨ã‚¹ã‚­ãƒ£ãƒ³ãƒ©ã‚¤ãƒ³åŠ¹æœã‚’è¿½åŠ 
        function addScanLineEffect() {
            const rankSection = document.querySelector('.theme-shadcn .rank-section');
            if (rankSection && !rankSection.querySelector('.scan-line')) {
                const scanLine = document.createElement('div');
                scanLine.className = 'scan-line';
                rankSection.appendChild(scanLine);
            }
        }

        // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤º/éè¡¨ç¤º
        function showColorPicker() {
            const modal = document.getElementById('colorPickerModal');
            modal.style.display = 'flex';
        }

        function closeColorPicker() {
            const modal = document.getElementById('colorPickerModal');
            modal.style.display = 'none';
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ãŸå¾Œã«å¹…èª¿æ•´ã‚’å®Ÿè¡Œï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
            setTimeout(() => {
                if (currentTheme === 'classic') {
                    resetLastMatchWidthForClassic();
                } else {
                    adjustLastMatchWidth();
                }
            }, 300);
        }

        // è‡ªå‹•æ›´æ–°æ©Ÿèƒ½ï¼ˆæ”¹å–„ç‰ˆï¼‰
        function startAutoUpdate(intervalSeconds = 60) {
            if (isAutoUpdateEnabled || !currentPlayerName || !currentPlayerTag) {
                return;
            }

            isAutoUpdateEnabled = true;
            console.log(`è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ˆ${intervalSeconds}ç§’é–“éš”ï¼‰`);

            // å®šæœŸçš„ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’æ›´æ–°
            updateInterval = setInterval(() => {
                if (currentPlayerName && currentPlayerTag) {
                    console.log('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’è‡ªå‹•æ›´æ–°ä¸­...');
                    updatePlayerInfo(currentPlayerName, currentPlayerTag).catch(error => {
                        console.error('è‡ªå‹•æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚è‡ªå‹•æ›´æ–°ã¯ç¶™ç¶š
                    });
                }
            }, intervalSeconds * 1000);
        }

        function stopAutoUpdate() {
            if (!isAutoUpdateEnabled) {
                return;
            }

            isAutoUpdateEnabled = false;
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
                console.log('è‡ªå‹•æ›´æ–°ã‚’åœæ­¢ã—ã¾ã—ãŸ');
            }
        }

        // OBSå°‚ç”¨ã®è‡ªå‹•æ›´æ–°æ©Ÿèƒ½ï¼ˆã‚ˆã‚Šå …ç‰¢ï¼‰
        function startOBSAutoUpdate(intervalSeconds = 60) {
            // æ—¢ã«é–‹å§‹ã•ã‚Œã¦ã„ã‚‹å ´åˆã¯åœæ­¢ã—ã¦ã‹ã‚‰å†é–‹å§‹
            if (updateInterval) {
                clearInterval(updateInterval);
            }
            
            isAutoUpdateEnabled = true;
            console.log(`OBSå°‚ç”¨è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã—ãŸï¼ˆ${intervalSeconds}ç§’é–“éš”ï¼‰`);
            
            // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
            updateAutoUpdateStatus();

            // å³åº§ã«ä¸€å›å®Ÿè¡Œã—ã¦ã‹ã‚‰å®šæœŸå®Ÿè¡Œã‚’é–‹å§‹
            if (currentPlayerName && currentPlayerTag) {
                updatePlayerInfo(currentPlayerName, currentPlayerTag).catch(error => {
                    console.error('åˆå›æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                });
            }

            // å®šæœŸå®Ÿè¡Œ
            updateInterval = setInterval(() => {
                if (currentPlayerName && currentPlayerTag) {
                    console.log(`[${new Date().toLocaleTimeString()}] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’è‡ªå‹•æ›´æ–°ä¸­...`);
                    updatePlayerInfo(currentPlayerName, currentPlayerTag).catch(error => {
                        console.error('è‡ªå‹•æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚è‡ªå‹•æ›´æ–°ã¯ç¶™ç¶š
                    });
                } else {
                    console.warn('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è‡ªå‹•æ›´æ–°ã‚’åœæ­¢ã—ã¾ã™ã€‚');
                    stopAutoUpdate();
                }
            }, intervalSeconds * 1000);
        }

        // è‡ªå‹•æ›´æ–°ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç”»é¢ã«åæ˜ 
        function updateAutoUpdateStatus() {
            const statusElement = document.getElementById('autoUpdateStatus');
            const timeElement = document.getElementById('lastUpdateTime');
            
            if (statusElement) {
                statusElement.textContent = isAutoUpdateEnabled ? 'æœ‰åŠ¹' : 'ç„¡åŠ¹';
                statusElement.style.color = isAutoUpdateEnabled ? '#4CAF50' : '#f44336';
            }
            
            if (timeElement) {
                timeElement.textContent = new Date().toLocaleTimeString();
            }
        }

        // ãƒšãƒ¼ã‚¸éè¡¨ç¤º/è¡¨ç¤ºæ™‚ã®è‡ªå‹•æ›´æ–°åˆ¶å¾¡ï¼ˆOBSç”¨ã«èª¿æ•´ï¼‰
        document.addEventListener('visibilitychange', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const isOBS = urlParams.has('obs');
            
            // OBSãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯å¯è¦–æ€§ã«é–¢ä¿‚ãªãè‡ªå‹•æ›´æ–°ã‚’ç¶™ç¶š
            if (isOBS) {
                console.log(`å¯è¦–æ€§å¤‰æ›´: ${document.hidden ? 'éè¡¨ç¤º' : 'è¡¨ç¤º'} - OBSãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚è‡ªå‹•æ›´æ–°ç¶™ç¶š`);
                return;
            }
            
            if (!currentPlayerName || !currentPlayerTag) {
                return;
            }

            if (document.hidden) {
                // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã§ãƒšãƒ¼ã‚¸ãŒéè¡¨ç¤ºã«ãªã£ãŸã‚‰æ›´æ–°ã‚’ä¸€æ™‚åœæ­¢
                if (isAutoUpdateEnabled) {
                    stopAutoUpdate();
                    console.log('ãƒšãƒ¼ã‚¸ãŒéè¡¨ç¤ºã«ãªã£ãŸãŸã‚è‡ªå‹•æ›´æ–°ã‚’ä¸€æ™‚åœæ­¢');
                }
            } else {
                // é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã§ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰æ›´æ–°ã‚’å†é–‹
                if (!isAutoUpdateEnabled) {
                    const updateFreq = parseInt(urlParams.get('updateInterval')) || 60;
                    startAutoUpdate(updateFreq);
                    console.log('ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚ŒãŸãŸã‚è‡ªå‹•æ›´æ–°ã‚’å†é–‹');
                }
            }
        });

        // ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        window.addEventListener('beforeunload', function() {
            stopAutoUpdate();
        });

        // ãƒ©ãƒ³ã‚¯èƒŒæ™¯è‰²ã®é€æ˜åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®æ›´æ–°
        document.getElementById('rankBgOpacitySlider').addEventListener('input', function(e) {
            document.getElementById('rankBgOpacityValue').textContent = e.target.value + '%';
        });

        // å‰å›ã®ãƒãƒƒãƒèƒŒæ™¯è‰²ã®é€æ˜åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®æ›´æ–°
        document.getElementById('lastMatchBgOpacitySlider').addEventListener('input', function(e) {
            document.getElementById('lastMatchBgOpacityValue').textContent = e.target.value + '%';
        });

        // å¢ƒç•Œç·šè‰²ã®é€æ˜åº¦ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®æ›´æ–°
        document.getElementById('borderOpacitySlider').addEventListener('input', function(e) {
            document.getElementById('borderOpacityValue').textContent = e.target.value + '%';
        });

        // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ã®é©ç”¨
        function applyCustomColors() {
            const rankBgColor = document.getElementById('rankBgColorPicker').value;
            const rankBgOpacity = document.getElementById('rankBgOpacitySlider').value;
            const lastMatchBgColor = document.getElementById('lastMatchBgColorPicker').value;
            const lastMatchBgOpacity = document.getElementById('lastMatchBgOpacitySlider').value;
            const textColor = document.getElementById('textColorPicker').value;
            const rrColor = document.getElementById('rrColorPicker').value;
            const borderColor = document.getElementById('borderColorPicker').value;
            const borderOpacity = document.getElementById('borderOpacitySlider').value;

            // ãƒ©ãƒ³ã‚¯èƒŒæ™¯è‰²ã‚’rgbaå½¢å¼ã«å¤‰æ›
            const rankR = parseInt(rankBgColor.slice(1, 3), 16);
            const rankG = parseInt(rankBgColor.slice(3, 5), 16);
            const rankB = parseInt(rankBgColor.slice(5, 7), 16);
            const rgbaRankBgColor = `rgba(${rankR}, ${rankG}, ${rankB}, ${rankBgOpacity / 100})`;

            // å‰å›ã®ãƒãƒƒãƒèƒŒæ™¯è‰²ã‚’rgbaå½¢å¼ã«å¤‰æ›
            const lastMatchR = parseInt(lastMatchBgColor.slice(1, 3), 16);
            const lastMatchG = parseInt(lastMatchBgColor.slice(3, 5), 16);
            const lastMatchB = parseInt(lastMatchBgColor.slice(5, 7), 16);
            const rgbaLastMatchBgColor = `rgba(${lastMatchR}, ${lastMatchG}, ${lastMatchB}, ${lastMatchBgOpacity / 100})`;

            // å¢ƒç•Œç·šè‰²ã‚’rgbaå½¢å¼ã«å¤‰æ›
            const borderR = parseInt(borderColor.slice(1, 3), 16);
            const borderG = parseInt(borderColor.slice(3, 5), 16);
            const borderB = parseInt(borderColor.slice(5, 7), 16);
            const rgbaBorderColor = `rgba(${borderR}, ${borderG}, ${borderB}, ${borderOpacity / 100})`;

            // CSSå¤‰æ•°ã‚’æ›´æ–°
            document.documentElement.style.setProperty('--rank-bg-color', rgbaRankBgColor);
            document.documentElement.style.setProperty('--last-match-bg-color', rgbaLastMatchBgColor);
            document.documentElement.style.setProperty('--text-color', textColor);
            document.documentElement.style.setProperty('--rr-color', rrColor);
            document.documentElement.style.setProperty('--border-color', rgbaBorderColor);

            // è¨­å®šã‚’ä¿å­˜
            localStorage.setItem('customRankBgColor', rankBgColor);
            localStorage.setItem('customRankBgOpacity', rankBgOpacity);
            localStorage.setItem('customLastMatchBgColor', lastMatchBgColor);
            localStorage.setItem('customLastMatchBgOpacity', lastMatchBgOpacity);
            localStorage.setItem('customTextColor', textColor);
            localStorage.setItem('customRrColor', rrColor);
            localStorage.setItem('customBorderColor', borderColor);
            localStorage.setItem('customBorderOpacity', borderOpacity);

            closeColorPicker();
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼é©ç”¨å¾Œã«å¹…èª¿æ•´ã‚’å®Ÿè¡Œï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
            setTimeout(() => {
                if (currentTheme === 'classic') {
                    resetLastMatchWidthForClassic();
                } else {
                    adjustLastMatchWidth();
                }
            }, 300);
        }

        // ã‚«ã‚¹ã‚¿ãƒ ã‚«ãƒ©ãƒ¼ã‚’ãƒªã‚»ãƒƒãƒˆ
        function resetCustomColors() {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™
            document.getElementById('rankBgColorPicker').value = '#3a444e';
            document.getElementById('rankBgOpacitySlider').value = '100';
            document.getElementById('rankBgOpacityValue').textContent = '100%';
            document.getElementById('lastMatchBgColorPicker').value = '#F44336';
            document.getElementById('lastMatchBgOpacitySlider').value = '100';
            document.getElementById('lastMatchBgOpacityValue').textContent = '100%';
            document.getElementById('textColorPicker').value = '#ffffff';
            document.getElementById('rrColorPicker').value = '#ff4655';
            document.getElementById('borderColorPicker').value = '#ff4655';
            document.getElementById('borderOpacitySlider').value = '100';
            document.getElementById('borderOpacityValue').textContent = '100%';

            // CSSå¤‰æ•°ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.documentElement.style.setProperty('--rank-bg-color', 'rgba(58, 68, 78, 1)');
            document.documentElement.style.setProperty('--last-match-bg-color', 'rgba(244, 67, 54, 1)');
            document.documentElement.style.setProperty('--text-color', '#ffffff');
            document.documentElement.style.setProperty('--rr-color', '#ff4655');
            document.documentElement.style.setProperty('--border-color', 'rgba(255, 70, 85, 1)');

            // localStorageã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒ è¨­å®šã‚’å‰Šé™¤
            localStorage.removeItem('customRankBgColor');
            localStorage.removeItem('customRankBgOpacity');
            localStorage.removeItem('customLastMatchBgColor');
            localStorage.removeItem('customLastMatchBgOpacity');
            localStorage.removeItem('customTextColor');
            localStorage.removeItem('customRrColor');
            localStorage.removeItem('customBorderColor');
            localStorage.removeItem('customBorderOpacity');

            // ãƒ†ãƒ¼ãƒã‚’ã‚¯ãƒ©ã‚·ãƒƒã‚¯ã«æˆ»ã™
            applyTheme('classic');
            
            // ãƒªã‚»ãƒƒãƒˆå¾Œã«å¹…èª¿æ•´ã‚’å®Ÿè¡Œï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
            setTimeout(() => {
                // ãƒªã‚»ãƒƒãƒˆå¾Œã¯ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒã«ãªã‚‹ã®ã§ã€ã‚¯ãƒ©ã‚·ãƒƒã‚¯ç”¨ã®å‡¦ç†ã‚’å®Ÿè¡Œ
                resetLastMatchWidthForClassic();
            }, 300);
        }

        // ä¿å­˜ã•ã‚ŒãŸè¨­å®šã‚’èª­ã¿è¾¼ã‚€
        function loadSavedSettings() {
            const savedRankBgColor = localStorage.getItem('customRankBgColor');
            const savedRankBgOpacity = localStorage.getItem('customRankBgOpacity');
            const savedLastMatchBgColor = localStorage.getItem('customLastMatchBgColor');
            const savedLastMatchBgOpacity = localStorage.getItem('customLastMatchBgOpacity');
            const savedTextColor = localStorage.getItem('customTextColor');
            const savedRrColor = localStorage.getItem('customRrColor');
            const savedBorderColor = localStorage.getItem('customBorderColor');
            const savedBorderOpacity = localStorage.getItem('customBorderOpacity');
            const savedTheme = localStorage.getItem('selectedTheme');

            if (savedRankBgColor && savedRankBgOpacity && savedTextColor) {
                // ãƒ©ãƒ³ã‚¯èƒŒæ™¯è‰²ã®è¨­å®š
                const rankR = parseInt(savedRankBgColor.slice(1, 3), 16);
                const rankG = parseInt(savedRankBgColor.slice(3, 5), 16);
                const rankB = parseInt(savedRankBgColor.slice(5, 7), 16);
                const rgbaRankBgColor = `rgba(${rankR}, ${rankG}, ${rankB}, ${savedRankBgOpacity / 100})`;

                // å‰å›ã®ãƒãƒƒãƒèƒŒæ™¯è‰²ã®è¨­å®š
                if (savedLastMatchBgColor && savedLastMatchBgOpacity) {
                    const lastMatchR = parseInt(savedLastMatchBgColor.slice(1, 3), 16);
                    const lastMatchG = parseInt(savedLastMatchBgColor.slice(3, 5), 16);
                    const lastMatchB = parseInt(savedLastMatchBgColor.slice(5, 7), 16);
                    const rgbaLastMatchBgColor = `rgba(${lastMatchR}, ${lastMatchG}, ${lastMatchB}, ${savedLastMatchBgOpacity / 100})`;
                    document.documentElement.style.setProperty('--last-match-bg-color', rgbaLastMatchBgColor);
                }

                // å¢ƒç•Œç·šè‰²ã®è¨­å®š
                if (savedBorderColor && savedBorderOpacity) {
                    const borderR = parseInt(savedBorderColor.slice(1, 3), 16);
                    const borderG = parseInt(savedBorderColor.slice(3, 5), 16);
                    const borderB = parseInt(savedBorderColor.slice(5, 7), 16);
                    const rgbaBorderColor = `rgba(${borderR}, ${borderG}, ${borderB}, ${savedBorderOpacity / 100})`;
                    document.documentElement.style.setProperty('--border-color', rgbaBorderColor);
                }

                document.documentElement.style.setProperty('--rank-bg-color', rgbaRankBgColor);
                document.documentElement.style.setProperty('--text-color', savedTextColor);
                if (savedRrColor) {
                    document.documentElement.style.setProperty('--rr-color', savedRrColor);
                }

                // ã‚«ãƒ©ãƒ¼ãƒ”ãƒƒã‚«ãƒ¼ã®å€¤ã‚’æ›´æ–°
                document.getElementById('rankBgColorPicker').value = savedRankBgColor;
                document.getElementById('rankBgOpacitySlider').value = savedRankBgOpacity;
                document.getElementById('rankBgOpacityValue').textContent = savedRankBgOpacity + '%';
                if (savedLastMatchBgColor && savedLastMatchBgOpacity) {
                    document.getElementById('lastMatchBgColorPicker').value = savedLastMatchBgColor;
                    document.getElementById('lastMatchBgOpacitySlider').value = savedLastMatchBgOpacity;
                    document.getElementById('lastMatchBgOpacityValue').textContent = savedLastMatchBgOpacity + '%';
                }
                document.getElementById('textColorPicker').value = savedTextColor;
                if (savedRrColor) {
                    document.getElementById('rrColorPicker').value = savedRrColor;
                }
                if (savedBorderColor) {
                    document.getElementById('borderColorPicker').value = savedBorderColor;
                }
                if (savedBorderOpacity) {
                    document.getElementById('borderOpacitySlider').value = savedBorderOpacity;
                    document.getElementById('borderOpacityValue').textContent = savedBorderOpacity + '%';
                }
            }

            // ãƒ†ãƒ¼ãƒè¨­å®šã‚’é©ç”¨
            if (savedTheme) {
                applyTheme(savedTheme);
            }
        }

        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–å‡¦ç†
        function initializePage() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–å¾—
            const urlParams = new URLSearchParams(window.location.search);
            const name = urlParams.get('name');
            const tag = urlParams.get('tag');
            const isOBS = urlParams.has('obs');
            const updateFreq = parseInt(urlParams.get('updateInterval')) || 60;

            // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š
            currentPlayerName = name;
            currentPlayerTag = tag;

            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã‚’èª­ã¿è¾¼ã¿
            const urlRankBgColor = urlParams.get('rankBgColor');
            const urlRankBgOpacity = urlParams.get('rankBgOpacity');
            const urlLastMatchBgColor = urlParams.get('lastMatchBgColor');
            const urlLastMatchBgOpacity = urlParams.get('lastMatchBgOpacity');
            const urlTextColor = urlParams.get('textColor');
            const urlRrColor = urlParams.get('rrColor');
            const urlBorderColor = urlParams.get('borderColor');
            const urlBorderOpacity = urlParams.get('borderOpacity');
            const urlTheme = urlParams.get('theme');

            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰è‰²è¨­å®šã‚’é©ç”¨
            if (urlRankBgColor && urlRankBgOpacity && urlTextColor) {
                const rankR = parseInt(urlRankBgColor.slice(1, 3), 16);
                const rankG = parseInt(urlRankBgColor.slice(3, 5), 16);
                const rankB = parseInt(urlRankBgColor.slice(5, 7), 16);
                const rgbaRankBgColor = `rgba(${rankR}, ${rankG}, ${rankB}, ${urlRankBgOpacity / 100})`;
                document.documentElement.style.setProperty('--rank-bg-color', rgbaRankBgColor);
                document.documentElement.style.setProperty('--text-color', urlTextColor);

                if (urlLastMatchBgColor && urlLastMatchBgOpacity) {
                    const lastMatchR = parseInt(urlLastMatchBgColor.slice(1, 3), 16);
                    const lastMatchG = parseInt(urlLastMatchBgColor.slice(3, 5), 16);
                    const lastMatchB = parseInt(urlLastMatchBgColor.slice(5, 7), 16);
                    const rgbaLastMatchBgColor = `rgba(${lastMatchR}, ${lastMatchG}, ${lastMatchB}, ${urlLastMatchBgOpacity / 100})`;
                    document.documentElement.style.setProperty('--last-match-bg-color', rgbaLastMatchBgColor);
                }

                if (urlRrColor) {
                    document.documentElement.style.setProperty('--rr-color', urlRrColor);
                }

                if (urlBorderColor && urlBorderOpacity) {
                    const borderR = parseInt(urlBorderColor.slice(1, 3), 16);
                    const borderG = parseInt(urlBorderColor.slice(3, 5), 16);
                    const borderB = parseInt(urlBorderColor.slice(5, 7), 16);
                    const rgbaBorderColor = `rgba(${borderR}, ${borderG}, ${borderB}, ${urlBorderOpacity / 100})`;
                    document.documentElement.style.setProperty('--border-color', rgbaBorderColor);
                }
            } else {
                // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«è‰²è¨­å®šãŒãªã„å ´åˆã¯localStorageã‹ã‚‰èª­ã¿è¾¼ã‚€
                loadSavedSettings();
                
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ç¢ºå®Ÿã«è¨­å®šï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒ™ãƒ¼ã‚¹ç”¨ï¼‰
                if (!localStorage.getItem('customRankBgColor')) {
                    document.documentElement.style.setProperty('--rank-bg-color', 'rgba(58, 68, 78, 1)');
                }
            }

            // ãƒ†ãƒ¼ãƒè¨­å®šã‚’é©ç”¨
            if (urlTheme) {
                applyTheme(urlTheme);
            } else {
                const savedTheme = localStorage.getItem('selectedTheme');
                if (savedTheme) {
                    applyTheme(savedTheme);
                }
            }

            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰é–‰ã˜ã‚‹
            window.onclick = function(event) {
                const modal = document.getElementById('colorPickerModal');
                if (event.target == modal) {
                    closeColorPicker();
                }
            }

            if (name && tag) {
                // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
                document.getElementById('inputSection').style.display = 'none';

                if (isOBS) {
                    // OBSãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´
                    document.body.style.backgroundColor = 'transparent';
                    document.body.style.overflow = 'hidden';
                    // bodyã«OBSãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                    document.body.classList.add('obs-mode');

                    // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                    const headerElement = document.querySelector('.app-header');
                    if (headerElement) {
                        headerElement.style.display = 'none';
                    }

                    // èƒŒæ™¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¦ç´ ã‚’éè¡¨ç¤º
                    const backgroundElement = document.querySelector('.background');
                    if (backgroundElement) {
                        backgroundElement.style.display = 'none';
                    }

                    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®OBSå‘ã‘ä½ç½®èª¿æ•´ï¼ˆä¸­å¤®ã«é…ç½®ï¼‰
                    const overlayElement = document.querySelector('.overlay');
                    if (overlayElement) {
                        overlayElement.style.position = 'absolute';
                        overlayElement.style.top = '50%';
                        overlayElement.style.left = '50%';
                        overlayElement.style.right = 'auto';
                        overlayElement.style.transform = 'translate(-50%, -50%)';
                        
                        // OBSãƒ–ãƒ©ã‚¦ã‚¶ã‚½ãƒ¼ã‚¹ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´
                        adjustOBSScale();
                    }

                    // è£½ä½œè€…ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                    const authorSectionElement = document.querySelector('.author-section');
                    if (authorSectionElement) {
                        authorSectionElement.style.display = 'none';
                    }

                    // OBSãƒ¢ãƒ¼ãƒ‰ã§ã¯è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹
                    console.log(`OBSãƒ¢ãƒ¼ãƒ‰ã§è‡ªå‹•æ›´æ–°ã‚’æœ‰åŠ¹åŒ–ï¼ˆ${updateFreq}ç§’é–“éš”ï¼‰`);

                } else {
                    // é€šå¸¸ã®ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºã§ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ä½ç½®èª¿æ•´
                    document.querySelector('.overlay').style.top = '50%';
                    document.querySelector('.overlay').style.transform = 'translateY(-50%)';
                }

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’æ›´æ–°ï¼ˆåˆå›ï¼‰
                updatePlayerInfo(name, tag).then(() => {
                    // åˆå›æ›´æ–°å®Œäº†å¾Œã€OBSãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹
                    if (isOBS) {
                        startAutoUpdate(updateFreq);
                    }
                }).catch(error => {
                    console.error('åˆå›ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚OBSãƒ¢ãƒ¼ãƒ‰ãªã‚‰è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹
                    if (isOBS) {
                        console.log('åˆå›å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€OBSãƒ¢ãƒ¼ãƒ‰ã®ãŸã‚è‡ªå‹•æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã™');
                        startOBSAutoUpdate(updateFreq);
                    }
                });
                
                // OBSãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã€åˆå›æ›´æ–°ã¨ä¸¦è¡Œã—ã¦è‡ªå‹•æ›´æ–°ã‚‚é–‹å§‹ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                if (isOBS) {
                    // å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰è‡ªå‹•æ›´æ–°ã‚’ç¢ºå®Ÿã«é–‹å§‹
                    setTimeout(() => {
                        if (!isAutoUpdateEnabled) {
                            console.log('ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: OBSè‡ªå‹•æ›´æ–°ã‚’å¼·åˆ¶é–‹å§‹');
                            startOBSAutoUpdate(updateFreq);
                        }
                    }, 2000);
                }
            } else if (isOBS) {
                // name, tag ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒãªã„ãŒ OBS ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆ
                document.getElementById('inputSection').style.display = 'none';
                
                // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                const headerElement = document.querySelector('.app-header');
                if (headerElement) {
                    headerElement.style.display = 'none';
                }
                
                // bodyã«OBSãƒ¢ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                document.body.classList.add('obs-mode');
                
                const backgroundElement = document.querySelector('.background');
                if (backgroundElement) {
                    backgroundElement.style.display = 'none';
                }
                // ãƒ‡ãƒ¼ã‚¿ãŒãªã„æ—¨ã‚’è¡¨ç¤º
                document.getElementById('rankText').textContent = 'æƒ…å ±ãªã—';
                document.getElementById('rrText').textContent = '';
                document.getElementById('lastMatchSection').style.display = 'none';
            }

            // æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´æ©Ÿèƒ½ã‚’åˆæœŸåŒ–
            observeOverlayResize();

            // åˆæœŸåŒ–å®Œäº†å¾Œã«å¹…èª¿æ•´ã‚’å®Ÿè¡Œï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
            setTimeout(() => {
                if (currentTheme === 'classic') {
                    resetLastMatchWidthForClassic();
                } else {
                    adjustLastMatchWidth();
                }
            }, 500);
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ã‚ˆã‚Šç¢ºå®Ÿã«å¹…èª¿æ•´ã‚’å®Ÿè¡Œ
            setTimeout(() => {
                if (currentTheme === 'classic') {
                    resetLastMatchWidthForClassic();
                } else {
                    adjustLastMatchWidth();
                }
            }, 1000);
            
            setTimeout(() => {
                if (currentTheme === 'classic') {
                    resetLastMatchWidthForClassic();
                } else {
                    adjustLastMatchWidth();
                }
            }, 2000);

            // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            const customizeButton = document.getElementById('customizeButton');
            if (customizeButton) {
                customizeButton.addEventListener('click', showColorPicker);
            }

            // ãƒ†ãƒ¼ãƒãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
            document.querySelectorAll('.theme-button').forEach(button => {
                button.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    applyTheme(theme);
                    // ãƒ†ãƒ¼ãƒå¤‰æ›´å¾Œã«å¹…èª¿æ•´ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
                    setTimeout(() => {
                        if (theme === 'classic') {
                            resetLastMatchWidthForClassic();
                        } else {
                            adjustLastMatchWidth();
                        }
                    }, 300);
                });
            });
        }

        // æ–‡å­—é€”åˆ‡ã‚Œé˜²æ­¢ã®ãŸã‚ã®å‹•çš„èª¿æ•´æ©Ÿèƒ½
        function adjustTextSize() {
            const overlay = document.querySelector('.overlay');
            if (!overlay) return;

            const rankName = overlay.querySelector('.rank-name');
            const rrText = overlay.querySelector('.rr');
            const lastMatchText = overlay.querySelector('.last-match-text');

            // ãƒ©ãƒ³ã‚¯åã®èª¿æ•´
            if (rankName) {
                adjustElementText(rankName, overlay);
            }

            // RRãƒ†ã‚­ã‚¹ãƒˆã®èª¿æ•´
            if (rrText) {
                adjustElementText(rrText, overlay);
            }

            // å‰å›ã®ãƒãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã®èª¿æ•´
            if (lastMatchText) {
                adjustElementText(lastMatchText, overlay);
            }

            // å‰å›ã®ãƒãƒƒãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¹…ã‚’ãƒ©ãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
            adjustLastMatchWidth();

            // å…¨ãƒ†ãƒ¼ãƒã§æ¨ªå¹…ã‚’è‡ªå‹•èª¿æ•´
            adjustOverlayWidth();
        }

        // å‰å›ã®ãƒãƒƒãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¹…ã‚’ãƒ©ãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹æ©Ÿèƒ½ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã®ã¿ï¼‰
        function adjustLastMatchWidth() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆï¼ˆURLç”Ÿæˆå¾Œï¼‰ã¯ä½•ã‚‚ã—ãªã„
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('name') || urlParams.has('tag')) {
                return;
            }
            
            // ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒã®å ´åˆã¯å…ƒã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ä¿æŒ
            if (currentTheme === 'classic') {
                console.log('ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒã®ãŸã‚å¹…èª¿æ•´ã‚’ã‚¹ã‚­ãƒƒãƒ—');
                return;
            }
            
            const rankSection = document.querySelector('.rank-section');
            const lastMatchSection = document.querySelector('.last-match-section');
            
            if (!rankSection || !lastMatchSection) return;

            // ãƒ©ãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å®Ÿéš›ã®å¹…ã‚’å–å¾—
            const rankSectionWidth = rankSection.offsetWidth;
            
            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§ã®ã¿CSSåˆ¶ç´„ã‚’è§£é™¤ã—ã¦å¹…ã¨ä½ç½®ã‚’è¨­å®šï¼ˆã‚¯ãƒ©ã‚·ãƒƒã‚¯ä»¥å¤–ã®ãƒ†ãƒ¼ãƒï¼‰
            lastMatchSection.style.width = rankSectionWidth + 'px';
            lastMatchSection.style.minWidth = rankSectionWidth + 'px';
            lastMatchSection.style.maxWidth = rankSectionWidth + 'px';
            lastMatchSection.style.boxSizing = 'border-box';
            lastMatchSection.style.margin = '0 auto'; // ä¸­å¤®æƒãˆ
            lastMatchSection.style.display = 'block'; // ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ã¨ã—ã¦è¡¨ç¤º
            
            // ãƒ©ãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨å‰å›ã®ãƒãƒƒãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ä½ç½®ã‚’å®Œå…¨ã«åŒæœŸ
            const rankSectionStyle = window.getComputedStyle(rankSection);
            const rankSectionRect = rankSection.getBoundingClientRect();
            const overlay = rankSection.closest('.overlay');
            
            if (overlay) {
                const overlayRect = overlay.getBoundingClientRect();
                const rankLeftOffset = rankSectionRect.left - overlayRect.left;
                
                // å‰å›ã®ãƒãƒƒãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ©ãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨åŒã˜å·¦ä½ç½®ã«é…ç½®
                lastMatchSection.style.marginLeft = rankLeftOffset + 'px';
                lastMatchSection.style.marginRight = 'auto';
            }
            
            console.log(`å‰å›ã®ãƒãƒƒãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³å¹…èª¿æ•´ï¼ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ãƒ»${currentTheme}ãƒ†ãƒ¼ãƒï¼‰: ${rankSectionWidth}px`);
        }

        // ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒç”¨ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹æ©Ÿèƒ½ï¼ˆå†æ§‹ç¯‰ç‰ˆï¼‰
        function resetLastMatchWidthForClassic() {
            // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆï¼ˆURLç”Ÿæˆå¾Œï¼‰ã¯ä½•ã‚‚ã—ãªã„
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.has('name') || urlParams.has('tag')) {
                return;
            }
            
            const lastMatchSection = document.querySelector('.last-match-section');
            const rankSection = document.querySelector('.rank-section');
            if (!lastMatchSection || !rankSection) return;
            
            // ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒã§ã¯æ–°ã—ã„CSSæ§‹é€ ã«ã‚ˆã‚Šè‡ªå‹•çš„ã«å¹…ãŒçµ±ä¸€ã•ã‚Œã‚‹
            // è¿½åŠ ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ã‚’ãƒªã‚»ãƒƒãƒˆ
            lastMatchSection.style.width = '';
            lastMatchSection.style.minWidth = '';
            lastMatchSection.style.maxWidth = '';
            lastMatchSection.style.marginLeft = '';
            lastMatchSection.style.marginRight = '';
            
            console.log('ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ†ãƒ¼ãƒ: CSSæ§‹é€ ã«ã‚ˆã‚Šè‡ªå‹•å¹…çµ±ä¸€');
        }

        // å…¨ãƒ†ãƒ¼ãƒã®æ¨ªå¹…è‡ªå‹•èª¿æ•´æ©Ÿèƒ½ï¼ˆæœ€å°å¹…ã«èª¿æ•´ï¼‰
        function adjustOverlayWidth() {
            const overlay = document.querySelector('.overlay');
            if (!overlay) return;

            // å…¨ãƒ†ãƒ¼ãƒã§CSSã«ã‚ˆã‚‹æœ€å°å¹…èª¿æ•´ãŒé©ç”¨ã•ã‚Œã‚‹
            console.log(`${currentTheme}ãƒ†ãƒ¼ãƒ: CSSã«ã‚ˆã‚‹æœ€å°å¹…èª¿æ•´ã‚’é©ç”¨`);
        }

        function adjustElementText(element, container) {
            // å‰å›ã®ãƒãƒƒãƒãƒ†ã‚­ã‚¹ãƒˆã¯èª¿æ•´ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå°‚ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠå¹…ã‚’ä½¿ç”¨ã™ã‚‹ãŸã‚ï¼‰
            if (element && element.classList.contains('last-match-text')) {
                return;
            }

            const containerWidth = container.offsetWidth;
            const elementWidth = element.scrollWidth;
            
            // ãƒ†ã‚­ã‚¹ãƒˆãŒã‚³ãƒ³ãƒ†ãƒŠã‚ˆã‚Šå¤§ãã„å ´åˆ
            if (elementWidth > containerWidth * 0.9) {
                const currentFontSize = parseFloat(window.getComputedStyle(element).fontSize);
                const ratio = (containerWidth * 0.85) / elementWidth;
                const newFontSize = Math.max(currentFontSize * ratio, 10); // æœ€å°10px
                
                element.style.fontSize = newFontSize + 'px';
            }
        }

        // OBSãƒ–ãƒ©ã‚¦ã‚¶ã‚½ãƒ¼ã‚¹ã‚µã‚¤ã‚ºã«å¿œã˜ã¦ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´
        function adjustOBSScale() {
            const overlay = document.querySelector('.overlay');
            if (!overlay || !document.body.classList.contains('obs-mode')) return;

            // ãƒ–ãƒ©ã‚¦ã‚¶ã‚½ãƒ¼ã‚¹ã®ã‚µã‚¤ã‚ºã‚’å–å¾—
            const browserWidth = window.innerWidth;
            const browserHeight = window.innerHeight;
            
            // åŸºæº–ã‚µã‚¤ã‚ºï¼ˆ450x200ï¼‰ã«å¯¾ã™ã‚‹ã‚¹ã‚±ãƒ¼ãƒ«æ¯”ã‚’è¨ˆç®—
            const baseWidth = 450;
            const baseHeight = 200;
            
            const scaleX = browserWidth / baseWidth;
            const scaleY = browserHeight / baseHeight;
            
            // ç¸¦æ¨ªæ¯”ã‚’ä¿æŒã—ã¦ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆå°ã•ã„æ–¹ã®ã‚¹ã‚±ãƒ¼ãƒ«ã‚’ä½¿ç”¨ï¼‰
            const scale = Math.min(scaleX, scaleY, 3); // æœ€å¤§3å€ã¾ã§
            
            // ã‚¹ã‚±ãƒ¼ãƒ«é©ç”¨
            overlay.style.transform = `translate(-50%, -50%) scale(${scale})`;
            
            console.log(`OBSã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´: ${browserWidth}x${browserHeight} â†’ ã‚¹ã‚±ãƒ¼ãƒ« ${scale.toFixed(2)}`);
        }

        // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã«ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´
        window.addEventListener('resize', function() {
            if (document.body.classList.contains('obs-mode')) {
                adjustOBSScale();
            }
        });

        // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ã‚µã‚¤ã‚ºå¤‰æ›´ç›£è¦–
        function observeOverlayResize() {
            const overlay = document.querySelector('.overlay');
            if (!overlay) return;

            const resizeObserver = new ResizeObserver(entries => {
                for (let entry of entries) {
                    setTimeout(adjustTextSize, 100); // å°‘ã—é…å»¶ã•ã›ã¦ç¢ºå®Ÿã«èª¿æ•´
                }
            });

            resizeObserver.observe(overlay);
        }

        // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æ›´æ–°æ™‚ã«æ–‡å­—ã‚µã‚¤ã‚ºã‚‚èª¿æ•´
        function updatePlayerInfoWithTextAdjustment(name, tag) {
            return updatePlayerInfo(name, tag).then(() => {
                setTimeout(adjustTextSize, 200); // ãƒ‡ãƒ¼ã‚¿æ›´æ–°å¾Œã«èª¿æ•´
            });
        }

        async function updatePlayerInfo(name, tag) {
            try {
                console.log(`[${new Date().toLocaleTimeString()}] ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ã‚’å–å¾—ä¸­: ${name}#${tag}`);
                
                // å …ç‰¢ãªAPIå‘¼ã³å‡ºã—ã‚’ä½¿ç”¨ï¼ˆæ”¹å–„ã•ã‚ŒãŸfetchPlayerStatsé–¢æ•°ã‚’ä½¿ç”¨ï¼‰
                const stats = await fetchPlayerStats(name, tag);

                console.log('Stats response:', stats);

                if (stats && stats.data) {
                    const playerData = stats.data; // stats.data ã®å†…å®¹ã‚’ç›´æ¥ä½¿ç”¨
                    console.log(`[${new Date().toLocaleTimeString()}] ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ`);

                    // ãƒ©ãƒ³ã‚¯æƒ…å ±ã‚’æ›´æ–°
                    const currentRank = playerData.currenttierpatched;
                    const rankingInTier = playerData.ranking_in_tier;
                    const mmrChange = playerData.mmr_change_to_last_game; // MMRå¤‰å‹•å€¤ã‚’å–å¾—

                    if (currentRank) {
                        // APIã‹ã‚‰å–å¾—ã—ãŸç”»åƒã®URLã‚’ä½¿ç”¨
                        if (playerData.images && playerData.images.large) {
                             document.getElementById('rankIcon').src = playerData.images.large;
                        } else {
                             // APIã«ç”»åƒURLãŒãªã„å ´åˆã¯ãƒ­ãƒ¼ã‚«ãƒ«ç”»åƒã‚’ä½¿ç”¨ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
                             document.getElementById('rankIcon').src = getRankImageUrl(currentRank);
                        }

                        document.getElementById('rankText').textContent = currentRank;
                        document.getElementById('rrText').textContent = `${rankingInTier || 0}RR`;

                        // ç›´è¿‘ã®ãƒãƒƒãƒçµæœï¼ˆMMRå¤‰å‹•å€¤ï¼‰ã‚’æ›´æ–°
                        const lastMatchSection = document.getElementById('lastMatchSection');
                        const lastMatchText = document.getElementById('lastMatchText');
                        const mmrGaugeFill = lastMatchSection.querySelector('.mmr-gauge-fill');

                        // ç¾åœ¨ã®RRå€¤ã«åŸºã¥ã„ã¦ã‚²ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                        if (rankingInTier !== undefined && rankingInTier !== null) {
                            // å‰å›ã®ãƒãƒƒãƒã®çµæœã®ã¿è¡¨ç¤º
                            if (mmrChange !== undefined) {
                                const sign = mmrChange >= 0 ? '+' : '';
                                lastMatchText.textContent = `å‰å›ã®ãƒãƒƒãƒ ${sign}${mmrChange}pts`;
                            } else {
                                lastMatchText.textContent = 'å‰å›ã®ãƒãƒƒãƒ';
                            }

                            // ã‚²ãƒ¼ã‚¸ã®å¹…ã‚’è¨ˆç®—ï¼ˆRRå€¤ / 100 * 100 = ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ï¼‰
                            const gaugePercentage = Math.min(100, Math.max(0, rankingInTier)); // 0-100ã®ç¯„å›²ã«åˆ¶é™
                            
                            // å¸¸ã«ç·‘è‰²ã®ã‚²ãƒ¼ã‚¸ï¼ˆç¾åœ¨ã®ãƒ©ãƒ³ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¡¨ã™ãŸã‚ï¼‰
                            mmrGaugeFill.style.width = `${gaugePercentage}%`;
                            mmrGaugeFill.style.backgroundColor = '#4CAF50'; // ç·‘
                            mmrGaugeFill.style.left = '0';
                            mmrGaugeFill.style.right = 'auto';

                            lastMatchSection.style.display = 'flex'; // ã‚²ãƒ¼ã‚¸è¡¨ç¤ºã®ãŸã‚flexã«å¤‰æ›´
                        } else {
                            lastMatchSection.style.display = 'none';
                        }

                        console.log(`[${new Date().toLocaleTimeString()}] ãƒ©ãƒ³ã‚¯æƒ…å ±æ›´æ–°: ${currentRank} ${rankingInTier}RR`);

                    } else { // currentRank ãŒãªã„å ´åˆ (ä¾‹: ãƒ©ãƒ³ã‚¯ãªã—)
                        document.getElementById('rankIcon').src = 'assets/images/ranks/ãƒ©ãƒ³ã‚¯ãªã—.png';
                        document.getElementById('rankText').textContent = 'ãƒ©ãƒ³ã‚¯ãªã—';
                        document.getElementById('rrText').textContent = '';
                        document.getElementById('lastMatchSection').style.display = 'none';
                        console.log(`[${new Date().toLocaleTimeString()}] ãƒ©ãƒ³ã‚¯æƒ…å ±ãªã—`);
                    }

                } else { // stats ã¾ãŸã¯ stats.data ãŒå­˜åœ¨ã—ãªã„å ´åˆ
                    document.getElementById('rankIcon').src = 'assets/images/ranks/ãƒ©ãƒ³ã‚¯ãªã—.png';
                    document.getElementById('rankText').textContent = 'ãƒ‡ãƒ¼ã‚¿ãªã—';
                    document.getElementById('rrText').textContent = '';
                    document.getElementById('lastMatchSection').style.display = 'none';
                    console.log(`[${new Date().toLocaleTimeString()}] APIå¿œç­”ã«ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã¾ã›ã‚“`);
                }
                
                // æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’æ›´æ–°
                updateAutoUpdateStatus();

                // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±æ›´æ–°å¾Œã«æ–‡å­—ã‚µã‚¤ã‚ºã¨æ¨ªå¹…ã‚’èª¿æ•´
                setTimeout(() => {
                    adjustTextSize();
                    adjustOverlayWidth();
                }, 300);

            } catch (error) {
                console.error(`[${new Date().toLocaleTimeString()}] Error updating player info:`, error);
                
                // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã‚‚è¡¨ç¤ºã‚’ãƒªã‚»ãƒƒãƒˆ
                document.getElementById('rankIcon').src = 'assets/images/ranks/ãƒ©ãƒ³ã‚¯ãªã—.png';
                document.getElementById('rankText').textContent = 'ã‚¨ãƒ©ãƒ¼';
                document.getElementById('rrText').textContent = '';
                document.getElementById('lastMatchSection').style.display = 'none';
                
                // ã‚¨ãƒ©ãƒ¼æ™‚ã‚‚æœ€çµ‚æ›´æ–°æ™‚åˆ»ã‚’æ›´æ–°
                updateAutoUpdateStatus();
            }
        }

        function generateURL() {
            const playerName = document.getElementById('playerName').value;
            const playerTag = document.getElementById('playerTag').value;
            
            if (!playerName || !playerTag) {
                alert('ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã¨ã‚¿ã‚°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            const currentURL = window.location.href.split('?')[0];
            const urlParams = new URLSearchParams();
            urlParams.append('name', playerName);
            urlParams.append('tag', playerTag);
            urlParams.append('obs', ''); // OBSãƒ¢ãƒ¼ãƒ‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§è¿½åŠ 
            urlParams.append('updateInterval', '30'); // è‡ªå‹•æ›´æ–°é–“éš”ï¼ˆ30ç§’ï¼‰ã«çŸ­ç¸®

            // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºè¨­å®šã‚’URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦è¿½åŠ 
            const savedRankBgColor = localStorage.getItem('customRankBgColor');
            const savedRankBgOpacity = localStorage.getItem('customRankBgOpacity');
            const savedLastMatchBgColor = localStorage.getItem('customLastMatchBgColor');
            const savedLastMatchBgOpacity = localStorage.getItem('customLastMatchBgOpacity');
            const savedTextColor = localStorage.getItem('customTextColor');
            const savedRrColor = localStorage.getItem('customRrColor');
            const savedBorderColor = localStorage.getItem('customBorderColor');
            const savedBorderOpacity = localStorage.getItem('customBorderOpacity');
            const savedTheme = localStorage.getItem('selectedTheme');

            if (savedRankBgColor) urlParams.append('rankBgColor', savedRankBgColor);
            if (savedRankBgOpacity) urlParams.append('rankBgOpacity', savedRankBgOpacity);
            if (savedLastMatchBgColor) urlParams.append('lastMatchBgColor', savedLastMatchBgColor);
            if (savedLastMatchBgOpacity) urlParams.append('lastMatchBgOpacity', savedLastMatchBgOpacity);
            if (savedTextColor) urlParams.append('textColor', savedTextColor);
            if (savedRrColor) urlParams.append('rrColor', savedRrColor);
            if (savedBorderColor) urlParams.append('borderColor', savedBorderColor);
            if (savedBorderOpacity) urlParams.append('borderOpacity', savedBorderOpacity);
            if (savedTheme) urlParams.append('theme', savedTheme);
            
            const newURL = `${currentURL}?${urlParams.toString()}`;
            document.getElementById('generatedURL').value = newURL;
        }

        function copyURL() {
            const urlInput = document.getElementById('generatedURL');
            urlInput.select();
            document.execCommand('copy');
            alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
        }

        function manualUpdate() {
            console.log('æ‰‹å‹•æ›´æ–°ãŒå‘¼ã³å‡ºã•ã‚Œã¾ã—ãŸ');
            updatePlayerInfo(currentPlayerName, currentPlayerTag).then(() => {
                console.log('æ‰‹å‹•æ›´æ–°ãŒæˆåŠŸã—ã¾ã—ãŸ');
            }).catch(error => {
                console.error('æ‰‹å‹•æ›´æ–°ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
            });
        }

        // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®é–‹é–‰æ©Ÿèƒ½
        function toggleTutorial() {
            const content = document.getElementById('tutorialContent');
            const arrow = document.getElementById('tutorialArrow');
            
            if (content.classList.contains('expanded')) {
                // é–‰ã˜ã‚‹
                content.classList.remove('expanded');
                arrow.classList.remove('rotated');
            } else {
                // é–‹ã
                content.classList.add('expanded');
                arrow.classList.add('rotated');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', function() {
            initializePage();
        });
    </script>
</body>
</html> 
